<!--
  ~ Copyright 2012  Research Studios Austria Forschungsges.m.b.H.
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<div style="padding-top: 40px;padding-bottom: 8em;" xmlns="http://www.w3.org/1999/html">
	<div ng-show="showPublic()">
		<div style="font-size: 1.8em; text-align: center ;">
			<strong>Postbox</strong>
		</div>

		<div class="row"></br></div>

		<div class="col-md-4 col-md-offset-4">
			<input class="form-control" type="search" ng-model="search.$" style="padding-right: 30px;"/>
            <span class="glyphicon glyphicon-search" style="position: absolute;right: 0;padding: 8px 27px;"></span>
		</div>

		<div class="row"></br></br></br></div>

		<div>
            <!--Inbox-->
            <div id="inboxCollapse" class="well div-table col-lg-12">
                <div class="div-table-row">
                    <div class="div-table-cell pull-left additional-info-title text-center">Inbox</div>
                    <div class="div-table-cell pull-right">
                        <span >
                            <a href="" ng-show="inboxCollapsed" class="glyphicon glyphicon-chevron-up" ng-click="inboxCollapseClick()"></a>
                        </span>
                        <span >
                            <a href="" ng-show="!inboxCollapsed" class="glyphicon glyphicon-chevron-down" ng-click="inboxCollapseClick()"></a>
                        </span>
                    </div>
                </div>
            </div>
            <div id="inboxArea" ng-show="!inboxCollapsed" class="div-table col-lg-12">
                <table id="post-table"
                       class="table table-hover table-striped"
                       ng-init="resizableColumns('post-table');">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th ng-click="setSortParams('title')">Title</th>
                            <th>Unread</th> <!-- TODO sorting for conversations -->
                            <th ng-click="setSortParams('creationDate')">Created on</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr
                                ng-show="allNeedsCount>0"
                                ng-repeat="post in allNeeds | orderObjectBy:sortedField:reversedSort |filter: search">
                            <td class="col-lg-1">
                                <span style="display: none;">{{post.basicNeedType}}</span>
                                <img src="{{getTypePicURI(post.basicNeedType)}}"
                                     tooltip="{{post.basicNeedType}} (click to filter)"/>
                            </td>
                            <td><a style="font-weight:bold;" href ng-click="clickOnNeedPrivateLink(post)">{{post
                                .title}}</a></td>
                            <td>
                                <span>
                                    <span style="display: none;">{{unreadEventsByNeedByType}}</span>
                                    <i
                                            class="fa fa-comment-o fa-lg"></i>&nbsp;{{unreadEventsByNeedByType[post.uri].message.count}}
                                </span>
                                <span>
                                    <span style="display: none;">{{post.msg.reqText}}</span>
                                    <i
                                            class="fa fa-male fa-lg"></i>&nbsp;{{unreadEventsByNeedByType[post.uri].connect.count}}
                                </span>
                                <span ng-controller="MatchCountCtrl">
                                    <span style="display: none;">{{post.msg.matchText}}</span>
                                    <i
                                            class="fa fa-puzzle-piece fa-lg"></i>&nbsp;
                                    <span
                                            ng-bind-template="{{unreadEventsByNeedByType[post.uri].hint.count}}"/>
                                </span>
                            </td>
                            <td>{{post.creationDate | date}}</td>
                        </tr>
                        <tr ng-show="allNeedsCount<1">
                            <td class="col-lg-1">
                            </td>
                            <td>You don't have posts yet. Fill it by <a style="font-weight:bold;" href="#/home">creating new
                                posts</a></td>
                            <td>
                            </td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Confirmation dialog for deleting a draft -->
            <div ng-show="displayConfirmationDialog">
                <form class="form-horizontal container">
                    <div class="col-md-5 col-md-offset-4">
                        <div class="well">
                            <fieldset>
                                <legend>Do you really want to delete chosen draft?</legend>
                                <div class="row col-lg-12">
                                    <button type="button" ng-click="clickOnNoButton();" class="btn btn-primary col-lg-6">No</button>
                                    <button type="button" ng-click="clickOnYesButton();" class="btn btn-primary col-lg-6">Yes</button>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </form>
            </div>

            <!--Drafts-->
            <div id="draftsCollapse" class="well div-table col-lg-12">
                <div class="div-table-row">
                    <div class="div-table-cell pull-left additional-info-title text-center">Drafts</div>
                    <div class="div-table-cell pull-right">
                        <span >
                            <a href="" ng-show="draftsCollapsed" class="glyphicon glyphicon-chevron-up" ng-click="draftsCollapseClick()"></a>
                        </span>
                        <span >
                            <a href="" ng-show="!draftsCollapsed" class="glyphicon glyphicon-chevron-down" ng-click="draftsCollapseClick()"></a>
                        </span>
                    </div>
                </div>
            </div>
            <div id="draftsArea" ng-show="!draftsCollapsed" class="div-table col-lg-12">
                <table id="draft-table" st-table="drafts" class="table table-hover table-striped" ng-init="resizableColumns('draft-table');">
                    <thead>
                        <tr>
                            <th st-sort="type">Type</th>
                            <th st-sort="title">Title</th>
                            <th st-sort="datetime">
                                Created on
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-show="allDrafts.length>0" ng-repeat="draft in allDrafts | filter: search">
                            <td class="col-lg-1">
                                <span style="display: none;">{{draft.draft.basicNeedType}}</span>
                                <img src="{{getTypePicURI(draft.draft.basicNeedType)}}" tooltip="{{draft.draft.basicNeedType}} (click to filter)"/>
                            </td>
                            <!-- TODO step in create need needs to be specified -->
                            <td><a href="#/create-need/1" style="font-weight:bold;">{{draft.draft.title}}</a></td>
                            <td>{{draft.datetime | date}}</td>
                            <td><a href="" ng-click="clickOnRemoveButton($index);"><i class="fa fa-times-circle-o fa-lg"></i></a></td>
                        </tr>
                        <tr ng-show="allDrafts.length<1">
                            <td class="col-lg-1">
                            </td>
                            <td>You don't have drafts yet. </td>
                            <td>
                            </td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!--Closed-->
            <div id="closedCollapse" class="well div-table col-lg-12">
                <div class="div-table-row">
                    <div class="div-table-cell pull-left additional-info-title text-center">Closed</div>
                    <div class="div-table-cell pull-right">
                        <span >
                            <a href="" ng-show="closedCollapsed" class="glyphicon glyphicon-chevron-up" ng-click="closedCollapseClick()"></a>
                        </span>
                        <span >
                            <a href="" ng-show="!closedCollapsed" class="glyphicon glyphicon-chevron-down" ng-click="closedCollapseClick()"></a>
                        </span>
                    </div>
                </div>
            </div>
            <div id="closedArea" ng-show="!closedCollapsed" class="div-table col-lg-12">
                <table id="closed-table" st-table="closedList" class="table table-hover table-striped" ng-init="resizableColumns('closed-table');">
                    <thead>
                    <tr>
                        <th st-sort="type">Type</th>
                        <th st-sort="type">Title</th>
                        <th st-sort="datetime">
                            Closed on
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr ng-show="closedList.length>0" ng-repeat="closed in closedList | filter: search">
                            <td class="col-lg-1">
                                <span style="display: none;">{{closed.type}}</span>
                                <img src="{{getTypePicURI(closed.type)}}" tooltip="{{closed.type}} (click to filter)"/>
                            </td>
                            <td>{{closed.title}}</a></td>
                            <td>{{closed.datetime | date}}</td>
                        </tr>
                        <tr ng-show="closedList.length<1">
                            <td class="col-lg-1">
                            </td>
                            <td>You don't have closed posts yet. </td>
                            <td>
                            </td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
		</div>
	</div>
</div>